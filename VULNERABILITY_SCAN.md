# Vulnerability Scan with Endor Labs

This document describes how to run a vulnerability scan on this Java application using Endor Labs.

## Overview

This repository is configured to perform security scanning using Endor Labs, which can detect:
- **Vulnerabilities**: Known security vulnerabilities in dependencies
- **Secrets**: Leaked credentials or sensitive information in code
- **Dependencies**: Analysis of all project dependencies and their security posture

## Prerequisites

To run an Endor Labs vulnerability scan, you need:

1. **Endor Labs Account**: Sign up at https://endorlabs.com
2. **API Credentials**: Obtain from your Endor Labs account:
   - `ENDOR_API_KEY`: Your API key
   - `ENDOR_API_SECRET`: Your API secret
   - `ENDOR_NAMESPACE`: Your namespace (e.g., "yolo", "release-test")

## Running the Scan Locally

### Option 1: Using endorctl CLI

1. Install the Endor Labs CLI tool (`endorctl`):
   ```bash
   # Follow installation instructions from Endor Labs documentation
   ```

2. Set environment variables:
   ```bash
   export ENDOR_API_KEY="your-api-key"
   export ENDOR_API_SECRET="your-api-secret"
   export ENDOR_NAMESPACE="your-namespace"
   ```

3. Run the scan:
   ```bash
   endorctl scan --path=/path/to/app-java-demo
   ```

### Option 2: Using GitHub Actions

This repository includes a GitHub Actions workflow for automated scanning:

1. Configure repository secrets in GitHub:
   - Go to Settings → Secrets and variables → Actions
   - Add the following secrets:
     - `ENDOR_API_KEY`
     - `ENDOR_API_SECRET`
     - `ENDOR_API` (API endpoint, typically `https://api.endorlabs.com`)

2. The workflow is defined in `.github/workflows/main.yml` and can be triggered:
   - Manually via the Actions tab → "Run workflow"
   - Automatically on push/PR (if configured)

## Scan Types

The Endor Labs scan performs three types of analysis:

### 1. Vulnerability Scanning
- Scans all Maven dependencies for known CVEs
- Checks against multiple vulnerability databases
- Provides severity ratings and remediation guidance

### 2. Secret Detection
- Scans source code for leaked credentials
- Detects API keys, passwords, tokens, etc.
- Helps prevent credential exposure

### 3. Dependency Analysis
- Maps all direct and transitive dependencies
- Identifies outdated or unmaintained packages
- Provides dependency graph visualization

## Current Dependencies

This project uses Maven and includes dependencies such as:
- javax.servlet-api (3.1.0)
- commons-text (1.9)
- mysql-connector-java (5.1.42)
- log4j-core (2.3)
- And many others (see `pom.xml`)

Some of these dependencies may have known vulnerabilities that would be detected by the scan.

## Expected Output

A successful scan will provide:
- List of vulnerabilities found with severity levels
- Recommendations for dependency updates
- Secret scanning results
- Overall security score
- Actionable remediation steps

## Troubleshooting

### Authentication Errors
If you see `endor-auth-failure` or `Unauthorized request`:
- Verify your API credentials are correct
- Check that your namespace exists
- Ensure you have proper permissions in Endor Labs

### Resource Requirements
- The scan tool recommends at least 16GB of memory for Java projects
- Smaller memory configurations may work but could impact performance

## Integration with CI/CD

The GitHub Actions workflow (`.github/workflows/main.yml`) demonstrates integration:
- Runs on self-hosted runners
- Triggered via `workflow_dispatch` (manual)
- Uses Endor Labs GitHub Action (`endorlab/github-action@main`)
- Configurable with additional arguments

## Next Steps

1. Configure your Endor Labs API credentials
2. Run a scan using either local CLI or GitHub Actions
3. Review the findings
4. Address critical vulnerabilities
5. Set up automated scanning in your CI/CD pipeline

## Additional Resources

- [Endor Labs Documentation](https://docs.endorlabs.com)
- [Endor Labs GitHub Action](https://github.com/endorlab/github-action)
- Maven Security Best Practices
